# events {
#     worker_connections 1024;
# }

# http {
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;

#     # Upstream for WordPress php-fpm
#     upstream wordpress {
#         server wordpress:9000;
#     }

#     # Logging
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     # Server block for HTTPS
#     server {
#         listen 443 ssl;
#         server_name oaoulad-.42.fr;

#         # SSL Configuration
#         ssl_certificate /etc/nginx/ssl/oaoulad-.42.fr.crt;
#         ssl_certificate_key /etc/nginx/ssl/oaoulad-.42.fr.key;
#         ssl_protocols TLSv1.2 TLSv1.3;
#         ssl_ciphers HIGH:!aNULL:!MD5;

#         # Security headers
#         add_header X-Frame-Options "SAMEORIGIN" always;
#         add_header X-Content-Type-Options "nosniff" always;
#         add_header X-XSS-Protection "1; mode=block" always;

#         # Root directory and index
#         root /var/www/html;
#         index index.php index.html index.htm;

#         # WordPress location
#         location / {
#             try_files $uri $uri/ /index.php?$args;
#         }

#         # PHP handling
#         location ~ \.php$ {
#             include fastcgi_params;
#             fastcgi_pass wordpress;
#             fastcgi_index index.php;
#             fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#             fastcgi_param PATH_INFO $fastcgi_path_info;
            
#             # Security
#             fastcgi_param HTTP_PROXY "";
#             fastcgi_intercept_errors on;
#         }

#         # Deny access to sensitive files
#         location ~ /\.ht {
#             deny all;
#         }

#         # Deny access to wp-config.php
#         location ~ /wp-config.php {
#             deny all;
#         }

#         # Cache static files
#         location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
#             expires 1y;
#             add_header Cache-Control "public, immutable";
#         }
#     }

#     # Redirect HTTP to HTTPS (optional, but good practice)
#     server {
#         listen 80;
#         server_name oaoulad-.42.fr;
#         return 301 https://$server_name$request_uri;
#     }
# }


# Simple NGINX config for WordPress + SSL

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # WordPress PHP backend
    upstream wordpress {
        server wordpress:9000;
    }

    server {
        listen 443 ssl;
        server_name oaoulad-.42.fr;

        # SSL certificates
        ssl_certificate /etc/nginx/ssl/oaoulad-.42.fr.crt;
        ssl_certificate_key /etc/nginx/ssl/oaoulad-.42.fr.key;

        root /var/www/html;
        index index.php index.html;

        # WordPress routing
        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        # PHP files
        location ~ \.php$ {
            include fastcgi_params;
            fastcgi_pass wordpress;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        # Deny access to wp-config.php
        location ~ /wp-config.php {
            deny all;
        }
    }

    # Redirect HTTP to HTTPS
    server {
        listen 80;
        server_name oaoulad-.42.fr;
        return 301 https://$server_name$request_uri;
    }
}
